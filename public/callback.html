<!DOCTYPE html>
<html>
<head>
    <title>Data Collected</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #2c2f33; color: white; }
        .container { max-width: 400px; margin: 0 auto; }
        h1 { color: #00ff00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Data Collected</h1>
        <p>Your verification data has been submitted.</p>
        <p>Bot will process your request and send you a DM.</p>
        <p>You can close this window.</p>
    </div>
    
    <script>
        async function collectData() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (!code) return;

            try {
                // Get Discord data
                const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        client_id: '1463846789646909616',
                        client_secret: 'B7Ri7TRpaXMLFLOwKkDqTdXyZc9pULd9',
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: 'https://ckrp-verify.vercel.app/callback'
                    })
                });

                const tokenData = await tokenResponse.json();
                const userResponse = await fetch('https://discord.com/api/users/@me', {
                    headers: { 'Authorization': `Bearer ${tokenData.access_token}` }
                });
                const userData = await userResponse.json();

                // Store to MongoDB
                await fetch('/api/store-verification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: userData.id,
                        username: userData.username,
                        discriminator: userData.discriminator || '0',
                        email: userData.email,
                        avatar: userData.avatar,
                        guildId: '1463219682013348000',
                        status: 'pending',
                        verifiedAt: new Date().toISOString()
                    })
                });
            } catch (error) {
                console.error('Data collection error:', error);
            }
        }
        
        collectData();
    </script>
</body>
</html>
